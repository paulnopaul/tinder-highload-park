# 1. Тема и целевая аудитория

Тема - Tinder. Один из самых популярных сервисов знакомств. 

Аудитория - 

75 млн

Из них 

30 млн - США и Северная Америка

30 млн - Европа

12 млн - Остальной мир

3 млн - Россия (тк большую часть на себя берет Badoo)

# 2. Расчет нагрузки

## Продуктовые метрики

### Месячная аудитория

Tinder не раскрывает дневную аудиторию, но мы можем посмотреть примерные значения

![https://user-images.githubusercontent.com/33177954/135096543-9e4b5b9e-bb0c-41d8-8525-d57a68e96af1.png](https://user-images.githubusercontent.com/33177954/135096543-9e4b5b9e-bb0c-41d8-8525-d57a68e96af1.png)

### Дневная аудитория

Из месячной следует, что это около 1.5 млн пользователей в день.

### Средний размер хранилища пользователя
![image](https://user-images.githubusercontent.com/33177954/135312481-f13aa43d-a41d-4569-a267-e08f45758037.png)

### Среднее количество действий пользователей по типам в день
![image](https://user-images.githubusercontent.com/33177954/135312511-94ddbd7e-7ce0-4f3d-93e2-2afd8e301149.png)


## Технические метрики

### Размер хранения в разбивке по типам данных (в Тб)
![image](https://user-images.githubusercontent.com/33177954/135312566-01b42a8b-1937-4919-a389-ef61341993c4.png)

### Сетевой трафик

Из расчета, что в день происходит 8'500'000'000 запросов на фотографии, а размер одной фотографии - 500Кб, то общий дневной трафик - 4 150 400 Гбайт, т.е. 33 203 200 Гбит в день - 385 Гбит/c. Допустим, что 40 процентов трафика приходится на вечерние часы, с 18:00 до 22:00, из этого пиковая нагрузка - около 1000 ГБит/c. 

Свайп - около 2Кбайт, следовательно  на них уходит меньше 1 Гбит/c в среднем и до 1 Гбит/c на пике. 

Сообщение - 3 Кбайт, следовательно на них уходит меньше 1 Гбит/c в среднем и меньше 1 Гбит/с в пике
![image](https://user-images.githubusercontent.com/33177954/135312595-b6a71e1a-3950-4dfc-88aa-61e3dfbe32fe.png)

### RPS в разбивке по типам запросов
![image](https://user-images.githubusercontent.com/33177954/136426682-c4b3d7dd-2234-411e-89fa-dea551df62cd.png)

# 3. Логическая схема БД
![image](https://user-images.githubusercontent.com/33177954/145834221-76c08a23-1dd1-40c5-a5e9-3476339adc00.png)
# 4. Физическая схема БД
# 4. Физическая схема

| Name | Тип | Размер |
| --- | --- | --- |
| Photo ID | bigint | 8 |
| User ID | bigint | 8 |
| S3 link | varchar(256)  | 256 |

Т.е размер одной записи около 300 байт, всего фотографий 5 * 75'000'00 = 375'000'000. 

Размер базы ссылок на фотографии ~ 105 Гб

| Переменная | Тип | Размер |
| --- | --- | --- |
| Subsciption ID | bigint | 8 |
| User ID | bigint | 8 |
| Expiration Date | timestamp | 8 |
| Level | varchar(20) | 20 |
| Duration | varchar(20) | 20 |

Итого размер записи в этой таблице - 64 байта. Всего премиум-пользователей в тиндере около 7 миллионов, поэтому размер таблицы Около 0.5 Гб

| Переменная | Тип | Размер |
| --- | --- | --- |
| Match ID | bigint | 8 |
| First user ID | bigint | 8 |
| Second user ID | bigint | 8 |

Количество метчей постоянно растет, но рассчитывается, что в базе должны храниться около 30 миллиардов метчей. Общий размер ~ 670 Гб

| Переменная | Тип | Размер |
| --- | --- | --- |
| Message ID | bigint | 8 |
| Receiver ID | bigint | 8 |
| Sender ID | timestamp | 8 |
| Text | text | 256 |
| Time sent | timestamp | 8 |
| Is read | boolean | 1 |

Размер одного сообщения - около 300 байт. В базе хранятся около 43 800 000 000 сообщений, это около 15 терабайт.

| Name | Тип | Размер |
| --- | --- | --- |
| Session ID | bigint | 8 |
| User ID | bigint | 8 |
| Session Token | varchar(256) | 256 |
| Expiration Date | timestamp | 8 |

Есть около 11 миллионов уникальных пользователей в месяц, следовательно размер таблицы сессий ~ 3 Гб

| Переменная | Тип | Размер |
| --- | --- | --- |
| Swipe ID | bigint | 8 |
| User ID | bigint | 8 |
| Target ID | bigint | 8 |
| Is positive | boolearn | 1 |
| Swipe time | timestamp | 8 |

1600000000 свайпов в день - 1600000000. База свайпов занимает около 15 Тб

| Переменная | Тип | Размер |
| --- | --- | --- |
| User ID | bigint | 8 |
| Name | timestamp | 8 |
| Age | varchar(20) | 20 |
| City | varchar(20) | 20 |
| Gender | varchar(20) | 20 |
| Sex | varchar(20) | 20 |
| Interests | array[varchar(20] | 100 |
| University | varchar(100) | 100 |
| Position | varchar(100) | 100 |
| Company | varchar(100) | 100 |
| Instagram | varchar(100) | 100 |
| Spotify | varchar(100) | 100 |
| About | varchar(500) | 500 |

Около 100 миллионов аккаунтов ~ 120 Гб
![image](https://user-images.githubusercontent.com/33177954/145834473-6e5e1fe3-6ba4-4f34-8db4-50f87df99458.png)
Самая большая нагрузка на запись идет на получение профиля пользователя и на свайп.

18000 RPS на запись - таблица Swipes

1400 RPS на запись - таблица Mathes

18000 RPS - таблица Users

Т.к. Тиндер используется в первую очередь для локальных знакомств, необходимо шардирование по регионам + необходимы реплики на таблицу свайпов и пользователей.

Для ускорения отклика на свайп будем использовать ElasctiCache вместе с Redis

Для хранения изображений используется Amazon S3

# 5. Технологи

- Для написания Бекенда используем язык Go, набирающий огромную популярность и использующийся как раз для высоконагруженных веб-сервисов
- В качестве балансировщика нагрузки и веб-сервера будет использоваться nginx, так как это одно из самых быстрых и эффективных решений
- Базы данных - Postgres для персистентных данных как популярная и достаточно быстрая для наших целей СУБД, Redis + ElastiCache для хранения сессий и кеша
- Основная аудитория проекта - пользователи мобильных устройств, для разработки приложения используются Swift на IOS и Kotlin на Android как основные языки разработки для данных платформ

# 6. Схема проекта

![image](https://user-images.githubusercontent.com/33177954/145834581-df5ea99a-ba05-4039-ad46-e77ec90947f2.png)

# 7. Список серверов

Frontend

- Основная нагрузка идет с мобильных приложений, они загружаются с AppStore/PlayMarket
- Остальную статику положим в CloudFlare CDN

Nginx

| CPU | RAM | SSD |
| --- | --- | --- |
| 128 | 64 Gb | 128 Gb |

Golang-Backend

| CPU | RAM | SSD |
| --- | --- | --- |
| 64 | 64 Gb | 128 Gb |

Postgres

| CPU | RAM | HDD |
| --- | --- | --- |
| 16 | 64 Gb | 10 Tb |

Redis

| CPU | RAM | SSD |
| --- | --- | --- |
| 16 | 64 Gb | 128 |

Elasticache

- Поднят на AWS

# Источники

1. [https://www.businessofapps.com/data/tinder-statistics/](https://www.businessofapps.com/data/tinder-statistics/)
2. [https://www.semrush.com/analytics/traffic/overview/tinder.com?searchType=domain](https://www.semrush.com/analytics/traffic/overview/tinder.com?searchType=domain)
